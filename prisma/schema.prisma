generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// ============================================================
// ENUMS
// ============================================================

enum CategoryType {
  INCOME
  EXPENSE
}

enum TransactionType {
  INCOME
  EXPENSE
  TRANSFER_IN
  TRANSFER_OUT
}

enum WalletType {
  CASH
  BANK
  EWALLET
  CREDIT
}

enum RecurringInterval {
  DAILY
  WEEKLY
  MONTHLY
  YEARLY
}

// ============================================================
// USER
// ============================================================

model User {
  id        String   @id @default(uuid())
  name      String?
  email     String   @unique
  password  String

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  wallets              Wallet[]
  categories           Category[]
  transactions         Transaction[]
  budgets              Budget[]
  recurringTransactions RecurringTransaction[]
  plants Plan[]
  planSavings PlanSaving[]
}

// ============================================================
// CATEGORY
// ============================================================

model Category {
  id        String       @id @default(uuid())
  userId    String
  user      User         @relation(fields: [userId], references: [id])

  name      String
  type      CategoryType
  icon      String
  color     String

  createdAt DateTime     @default(now())
  updatedAt DateTime     @updatedAt

  transactions           Transaction[]
  budgets                Budget[]
  recurringTransactions  RecurringTransaction[]
}

// ============================================================
// WALLET
// ============================================================

model Wallet {
  id        String       @id @default(uuid())
  userId    String
  user      User         @relation(fields: [userId], references: [id])

  name      String
  type      WalletType
  balance   Int          @default(0)
  isPrimary Boolean      @default(false)

  createdAt DateTime     @default(now())
  updatedAt DateTime     @updatedAt

  transactions           Transaction[] @relation("WalletTransactions")
  transfersOut           Transaction[] @relation("TransferOut")
  transfersIn            Transaction[] @relation("TransferIn")
  recurringTransactions  RecurringTransaction[]
  planSavings PlanSaving[]
}

// ============================================================
// TRANSACTION
// ============================================================

model Transaction {
  id        String           @id @default(uuid())
  userId    String
  user      User             @relation(fields: [userId], references: [id])

  title     String
  amount    Int
  type      TransactionType
  date      DateTime
  note      String?

  // Category
  categoryId String?
  category   Category? @relation(fields: [categoryId], references: [id])

  // Main wallet
  walletId   String?
  wallet     Wallet?   @relation("WalletTransactions", fields: [walletId], references: [id])

  // Transfer relations
  fromWalletId String?
  fromWallet   Wallet? @relation("TransferOut", fields: [fromWalletId], references: [id])

  toWalletId   String?
  toWallet     Wallet? @relation("TransferIn", fields: [toWalletId], references: [id])

  // Receipt
  receiptUrl String?

  // Attachments
  attachments Attachment[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

// ============================================================
// BUDGET
// ============================================================

model Budget {
  id        String     @id @default(uuid())
  userId    String
  user      User       @relation(fields: [userId], references: [id])

  limit     Int
  period    String

  startDate DateTime?
  endDate   DateTime?

  categoryId String
  category   Category   @relation(fields: [categoryId], references: [id])

  createdAt  DateTime   @default(now())
  updatedAt  DateTime   @updatedAt
}

// ============================================================
// RECURRING TRANSACTIONS
// ============================================================

model RecurringTransaction {
  id        String             @id @default(uuid())
  userId    String
  user      User               @relation(fields: [userId], references: [id])

  title     String
  amount    Int
  type      TransactionType
  interval  RecurringInterval
  nextRun   DateTime
  active    Boolean            @default(true)

  categoryId String?
  category   Category? @relation(fields: [categoryId], references: [id])

  walletId   String?
  wallet     Wallet?    @relation(fields: [walletId], references: [id])

  createdAt  DateTime   @default(now())
  updatedAt  DateTime   @updatedAt
}

// ============================================================
// ATTACHMENT
// ============================================================

model Attachment {
  id            String     @id @default(uuid())
  url           String

  transactionId String
  transaction   Transaction @relation(fields: [transactionId], references: [id])

  createdAt     DateTime   @default(now())
}

model Plan {
  id            String     @id @default(uuid())
  userId        String
  user          User       @relation(fields: [userId], references: [id])

  name          String
  description   String?
  targetAmount  Int
  currentAmount Int        @default(0)
  targetDate    DateTime
  mode          String     // SIMPLE | BREAKDOWN

  createdAt     DateTime   @default(now())
  updatedAt     DateTime   @updatedAt

  // âœ… RELATION
  items         PlanItem[]
  savings       PlanSaving[]
}

model PlanItem {
  id        String   @id @default(uuid())
  planId   String
  plan     Plan     @relation(fields: [planId], references: [id], onDelete: Cascade)

  name      String
  amount    Int

  createdAt DateTime @default(now())
}

model PlanSaving {
  id        String   @id @default(uuid())
  userId    String
  planId    String
  walletId  String

  amount    Int
  note      String?
  date      DateTime @default(now())

  user      User     @relation(fields: [userId], references: [id])
  plan      Plan     @relation(fields: [planId], references: [id])
  wallet    Wallet   @relation(fields: [walletId], references: [id])
}

